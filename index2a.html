<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìë¬¼ì‡  ë¹„ë°€ë²ˆí˜¸ í’€ê¸°</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #2c3e50; font-size: 24px; }
    .box {
      border: 2px solid #ccc;
      padding: 16px;
      background-color: #f9f9f9;
      margin-top: 20px;
    }
    select, button {
      padding: 10px;
      font-size: 16px;
    }
    #timer {
      font-size: 20px;
      margin-top: 10px;
      color: #e74c3c;
      text-align: center;
    }
    .input-row {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .input-box {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    input.digit {
      width: 50px;
      height: 50px;
      font-size: 24px;
      text-align: center;
    }
    .timer-control {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 20px;
      gap: 10px;
      justify-content: center;
    }
    .feedback-list li {
      margin-bottom: 4px;
      font-size: 16px;
    }
    .hint-box {
      text-align: center;
      margin-top: 15px;
      font-size: 16px;
      color: #2c3e50;
    }

    @media (max-width: 600px) {
      h1 { font-size: 20px; }
      input.digit {
        width: 40px;
        height: 40px;
        font-size: 20px;
      }
      button, select {
        font-size: 14px;
        padding: 8px;
      }
    }
  </style>
</head>
<body>

  <h1>ğŸ” ìë¬¼ì‡  ë¹„ë°€ë²ˆí˜¸ í’€ê¸°</h1>

  <div class="box">
    <h3>ğŸ“˜ ì§€ë¬¸</h3>
    <p>ë‚œì´ë„ë¥¼ ì„ íƒí•˜ë©´ ë§¤ë²ˆ ë‹¤ë¥¸ ì¡°ê±´ì˜ ìë¬¼ì‡  ë¬¸ì œì™€ ì •ë‹µì´ ìƒì„±ë©ë‹ˆë‹¤.</p>
    <label>ğŸ§© ë‚œì´ë„ ì„ íƒ: </label>
    <select id="difficulty" onchange="generateProblem(true)">
      <option value="easy">ì‰¬ì›€</option>
      <option value="medium" selected>ë³´í†µ</option>
      <option value="hard">ì–´ë ¤ì›€</option>
    </select>
    <button onclick="showHint()">ğŸ’¡ íŒíŠ¸</button>
    <div class="hint-box" id="hintBox">íŒíŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
  </div>

  <div class="box">
    <h3>ğŸ“Œ ê·œì¹™</h3>
    <ul id="conditionList" class="feedback-list"></ul>
  </div>

  <div class="box">
    <h3>â“ ë¬¸ì œ</h3>
    <div class="input-row">
      <div class="input-box"><label>ì²«ì§¸</label><input type="text" maxlength="1" class="digit" /></div>
      <div class="input-box"><label>ë‘˜ì§¸</label><input type="text" maxlength="1" class="digit" /></div>
      <div class="input-box"><label>ì…‹ì§¸</label><input type="text" maxlength="1" class="digit" /></div>
      <div class="input-box"><label>ë„·ì§¸</label><input type="text" maxlength="1" class="digit" /></div>
    </div>

    <div style="text-align:center; margin-top: 20px;">
      <button id="submitBtn" onclick="submitAnswer()">ì •ë‹µ ì œì¶œ</button>
    </div>

    <div class="timer-control">
      <label>ğŸ•’ ì‹œê°„ ì„¤ì •:</label>
      <select id="timeSelect">
        <option value="30">30ì´ˆ</option>
        <option value="60">1ë¶„</option>
        <option value="90">1ë¶„ 30ì´ˆ</option>
        <option value="120">2ë¶„</option>
        <option value="150">2ë¶„ 30ì´ˆ</option>
        <option value="180">3ë¶„</option>
      </select>
      <button onclick="startTimer()">â³ ì‹œê°„ ì‹œì‘</button>
      <button onclick="pauseTimer(this)">â¸ï¸ ì‹œê°„ ë©ˆì¶¤</button>
    </div>

    <div id="timer"></div>
  </div>

  <script>
    let countdown, remainingTime = 0, timerPaused = false;
    let correctAnswer = "", currentConditions = [], hintStep = 0;

    const digits = document.querySelectorAll('.digit');
    const utils = {
      randInt: (min, max) => Math.floor(Math.random() * (max - min + 1)) + min,
      shuffle: (arr) => arr.sort(() => Math.random() - 0.5)
    };

    const generators = {
      easy: () => {
        const a = utils.randInt(1, 3);
        const b = utils.randInt(4, 6);
        const c = utils.randInt(7, 8);
        const d = 9;
        correctAnswer = `${a}${b}${c}${d}`;
        return {
          rules: [
            `ì²«ì§¸ ìë¦¬ëŠ” ${a}ì…ë‹ˆë‹¤.`,
            `ë‘˜ì§¸ ìë¦¬ëŠ” ${b}ì…ë‹ˆë‹¤.`,
            `ì…‹ì§¸ ìë¦¬ëŠ” ${c}ì…ë‹ˆë‹¤.`,
            `ë„·ì§¸ ìë¦¬ëŠ” 9ì…ë‹ˆë‹¤.`
          ],
          check: (digs) => [digs[0] == a, digs[1] == b, digs[2] == c, digs[3] == "9"]
        };
      },
      medium: () => {
        const a = utils.shuffle([1, 3])[0];
        const c = utils.shuffle([2, 4])[0];
        const b = c + 1;
        const d = utils.shuffle([6, 8])[0];
        correctAnswer = `${a}${b}${c}${d}`;
        return {
          rules: [
            "ì²«ì§¸ ìë¦¬ìˆ˜ëŠ” 5ë³´ë‹¤ ì‘ì€ í™€ìˆ˜ì…ë‹ˆë‹¤.",
            "ì…‹ì§¸ ìë¦¬ëŠ” 5ë³´ë‹¤ ì‘ì€ ì§ìˆ˜ì…ë‹ˆë‹¤.",
            "ë‘˜ì§¸ ìë¦¬ì™€ ì…‹ì§¸ ìë¦¬ëŠ” ì—°ì†ëœ ìˆ˜ì…ë‹ˆë‹¤.",
            "ë„·ì§¸ ìë¦¬ìˆ˜ëŠ” 6 ë˜ëŠ” 8ì…ë‹ˆë‹¤.",
            "ì²«ì§¸ + ë„·ì§¸ = ë‘˜ì§¸ + ì…‹ì§¸ì…ë‹ˆë‹¤."
          ],
          check: (d) => {
            const [A, B, C, D] = d.map(Number);
            return [
              [1, 3].includes(A),
              [2, 4].includes(C),
              Math.abs(B - C) === 1,
              [6, 8].includes(D),
              A + D === B + C
            ];
          }
        };
      },
      hard: () => {
        const a = 5;
        const b = utils.randInt(6, 7);
        const c = utils.shuffle([6, 8])[0];
        const d = 9;
        correctAnswer = `${a}${b}${c}${d}`;
        return {
          rules: [
            "ì²«ì§¸ ìë¦¬ëŠ” 5ì…ë‹ˆë‹¤.",
            "ë‘˜ì§¸ ìë¦¬ëŠ” ì²«ì§¸ë³´ë‹¤ í½ë‹ˆë‹¤.",
            "ì…‹ì§¸ ìë¦¬ëŠ” ì§ìˆ˜ì…ë‹ˆë‹¤.",
            "ë„·ì§¸ ìë¦¬ëŠ” 9ì…ë‹ˆë‹¤.",
            "ëª¨ë“  ìˆ«ìëŠ” 5 ì´ìƒì…ë‹ˆë‹¤."
          ],
          check: (d) => {
            const [A, B, C, D] = d.map(Number);
            return [
              A === 5,
              B > A,
              C % 2 === 0,
              D === 9,
              d.every(n => +n >= 5)
            ];
          }
        };
      }
    };

    function generateProblem(resetHint = false) {
      const level = document.getElementById("difficulty").value;
      const { rules, check } = generators[level]();
      currentConditions = check;
      correctAnswer = correctAnswer;
      localStorage.setItem('lockAnswer', correctAnswer);
      localStorage.setItem('lockRules', JSON.stringify(rules));
      localStorage.setItem('lockLevel', level);

      const list = document.getElementById("conditionList");
      list.innerHTML = "";
      rules.forEach((r, i) => {
        const li = document.createElement("li");
        li.id = `cond${i}`;
        li.innerHTML = `ğŸ”² ${r}`;
        list.appendChild(li);
      });

      digits.forEach(i => { i.value = ""; i.disabled = false; });
      document.getElementById("submitBtn").disabled = false;
      if (resetHint) {
        hintStep = 0;
        document.getElementById("hintBox").innerText = "íŒíŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.";
      }
    }

    function showHint() {
      hintStep++;
      const hintBox = document.getElementById("hintBox");
      if (hintStep === 1) {
        hintBox.innerText = `íŒíŠ¸ 1: ì²« ìˆ«ìëŠ” ${correctAnswer[0]}ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ìŠµë‹ˆë‹¤.`;
      } else if (hintStep === 2) {
        hintBox.innerText = `íŒíŠ¸ 2: ë§ˆì§€ë§‰ ìˆ«ìëŠ” ${correctAnswer[3]}ì…ë‹ˆë‹¤.`;
      } else {
        hintBox.innerText = `íŒíŠ¸ 3: ì •ë‹µì€ ${correctAnswer}ì…ë‹ˆë‹¤!`;
      }
    }

    function submitAnswer() {
      const inputs = Array.from(digits).map(i => i.value);
      if (inputs.some(v => isNaN(v) || v === "")) {
        alert("âš ï¸ ëª¨ë“  ì¹¸ì— ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      const checks = currentConditions(inputs);
      checks.forEach((pass, i) => {
        const el = document.getElementById(`cond${i}`);
        el.innerHTML = `${pass ? "âœ…" : "âŒ"} ${el.innerText.slice(2)}`;
        el.style.color = pass ? "green" : "red";
      });

      if (checks.every(Boolean)) {
        alert("ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! ìë¬¼ì‡ ê°€ ì—´ë ¸ìŠµë‹ˆë‹¤.");
        clearInterval(countdown);
        disableInputs();
      } else {
        alert("âŒ ì •ë‹µì´ ì•„ë‹™ë‹ˆë‹¤. ì¡°ê±´ì„ ë‹¤ì‹œ í™•ì¸í•´ë³´ì„¸ìš”.");
      }
    }

    function startTimer() {
      clearInterval(countdown);
      remainingTime = parseInt(document.getElementById("timeSelect").value);
      timerPaused = false;
      updateTimerDisplay();
      enableInputs(true);

      countdown = setInterval(() => {
        if (!timerPaused) {
          remainingTime--;
          updateTimerDisplay();
          if (remainingTime <= 0) {
            clearInterval(countdown);
            alert("â° ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
            disableInputs();
          }
        }
      }, 1000);
    }

    function pauseTimer(btn) {
      timerPaused = !timerPaused;
      btn.innerText = timerPaused ? "â–¶ï¸ ì‹œê°„ ë‹¤ì‹œ ì‹œì‘" : "â¸ï¸ ì‹œê°„ ë©ˆì¶¤";
    }

    function updateTimerDisplay() {
      const m = String(Math.floor(remainingTime / 60)).padStart(2, '0');
      const s = String(remainingTime % 60).padStart(2, '0');
      document.getElementById("timer").innerText = `â³ ë‚¨ì€ ì‹œê°„: ${m}:${s}`;
    }

    function disableInputs() {
      digits.forEach(i => i.disabled = true);
      document.getElementById("submitBtn").disabled = true;
    }

    function enableInputs(enable) {
      digits.forEach(i => i.disabled = !enable);
      document.getElementById("submitBtn").disabled = !enable;
    }

    // ì…ë ¥ í¬ì»¤ì‹± ë° ì œí•œ
    digits.forEach((input, idx) => {
      input.addEventListener('input', (e) => {
        const val = e.target.value;
        if (isNaN(val) || val < 0 || val > 9) {
          e.target.value = '';
          return;
        }
        if (val.length === 1 && idx < digits.length - 1) {
          digits[idx + 1].focus();
        }
      });
      input.addEventListener('keydown', (e) => {
        if (e.key === "Backspace" && input.value === '' && idx > 0) {
          digits[idx - 1].focus();
        }
      });
    });

    // ì´ˆê¸° ë¡œë“œ ì‹œ ì €ì¥ëœ ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸°
    window.onload = () => {
      if (localStorage.getItem("lockAnswer")) {
        correctAnswer = localStorage.getItem("lockAnswer");
        const rules = JSON.parse(localStorage.getItem("lockRules"));
        const level = localStorage.getItem("lockLevel");
        document.getElementById("difficulty").value = level;
        const list = document.getElementById("conditionList");
        list.innerHTML = "";
        rules.forEach((r, i) => {
          const li = document.createElement("li");
          li.id = `cond${i}`;
          li.innerHTML = `ğŸ”² ${r}`;
          list.appendChild(li);
        });
        currentConditions = generators[level]().check;
      } else {
        generateProblem(true);
      }
    };
  </script>

</body>
</html>
