<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¡œë´‡ ìµœë‹¨ê±°ë¦¬ ì²­ì†Œí•˜ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 20px;
      padding: 0;
      box-sizing: border-box;
    }
    h1 {
      color: #2c3e50;
      font-size: 24px;
    }
    .box {
      border: 2px solid #ccc;
      padding: 15px;
      background-color: #f9f9f9;
      margin-top: 10px;
    }
    table {
      border-collapse: collapse;
      margin-top: 10px;
      width: 100%;
      max-width: 400px;
    }
    td {
      width: 20%;
      height: 60px;
      border: 1px solid #333;
      text-align: center;
      vertical-align: middle;
      font-size: 20px;
    }
    .robot { background-color: lightblue; }
    .obstacle { background-color: gray; }
    .goal { background-color: lightgreen; }
    #timer { font-size: 24px; color: #e74c3c; margin-top: 10px; }
    select, button, textarea {
      margin-top: 10px;
      padding: 8px;
      font-size: 16px;
      width: 100%;
      box-sizing: border-box;
    }
    .hint {
      font-size: 16px;
      margin-top: 10px;
      color: #2c3e50;
    }
  </style>
</head>
<body>

<h1>ë¡œë´‡ ìµœë‹¨ê±°ë¦¬ ì²­ì†Œí•˜ê¸°</h1>

<div class="box">
  <h3>ğŸ“˜ CT ì‚¬ê³  ë‹¨ê³„</h3>
  <ol>
    <li><strong>ë¬¸ì œ ì´í•´:</strong> ë¡œë´‡ì´ ì“°ë ˆê¸°(G)ê¹Œì§€ ì´ë™</li>
    <li><strong>ë¬¸ì œ ë¶„í•´:</strong> ê²©ì êµ¬ì¡°, ì‹œì‘ì , ì¥ì• ë¬¼, ëª©ì ì§€ ì •ì˜</li>
    <li><strong>íŒ¨í„´ ì¸ì‹:</strong> ì¥ì• ë¬¼ì„ í”¼í•´ ê²½ë¡œ ì°¾ê¸°</li>
    <li><strong>ì¶”ìƒí™”:</strong> ê²©ì ë°ì´í„°ë¥¼ ì½”ë“œë¡œ í‘œí˜„</li>
    <li><strong>ì•Œê³ ë¦¬ì¦˜ ì„¤ê³„:</strong> ë°©í–¥í‚¤ë¥¼ ëˆŒëŸ¬ ë¡œë´‡ì„ ì´ë™, ë„ì°©í•˜ë©´ ì„±ê³µ</li>
  </ol>
</div>

<div class="box">
  <h3>ğŸ“Œ ê²©ì ì…ë ¥ ì €ì¥ ë° ëœë¤ ìƒì„±</h3>
  <textarea id="gridInput" rows="5"></textarea>
  <button onclick="generateRandomGrid()">ğŸ”€ ëœë¤ ë¬¸ì œ ìƒì„±</button>
  <button onclick="saveProblem()">ğŸ’¾ ë¬¸ì œ ì €ì¥</button>
  <button onclick="restartGame()">ğŸ”„ ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
</div>

<div class="box">
  <h3>ğŸ§­ ê²©ì ë° ë¡œë´‡ ì´ë™</h3>
  <table id="grid"></table>
</div>

<div>
  <label for="timeSelect">ğŸ•’ ì‹œê°„ ì„¤ì •:</label>
  <select id="timeSelect">
    <option value="30">30ì´ˆ</option>
    <option value="60">1ë¶„</option>
    <option value="90">1ë¶„ 30ì´ˆ</option>
    <option value="120">2ë¶„</option>
  </select>
  <button onclick="startTimer()">â³ ì‹œê°„ ì‹œì‘</button>
  <button onclick="pauseTimer()">â¸ï¸ ì‹œê°„ ë©ˆì¶¤</button>
</div>

<div id="timer"></div>
<div class="hint" id="hintBox">ğŸ’¡ íŒíŠ¸: ìµœë‹¨ê±°ë¦¬ ê²½ë¡œë¥¼ ìƒê°í•´ë³´ì„¸ìš”!</div>

<script>
let gridData = [];
let robotPos = { x: 0, y: 0 };
let countdown;
let remainingTime = 0;
let timerPaused = false;
let timeExpired = false;

function generateRandomGrid() {
  const options = ['.', '.', '.', '.', 'X'];
  const grid = [];
  for (let i = 0; i < 5; i++) {
    const row = [];
    for (let j = 0; j < 5; j++) {
      row.push(options[Math.floor(Math.random() * options.length)]);
    }
    grid.push(row);
  }
  grid[0][0] = 'S';
  grid[4][4] = 'G';
  document.getElementById("gridInput").value = grid.map(r => r.join(' ')).join('\n');
  loadGrid();
}

function saveProblem() {
  const blob = new Blob([document.getElementById("gridInput").value], { type: 'text/plain' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = "robot_problem.txt";
  link.click();
}

function loadGrid() {
  const input = document.getElementById("gridInput").value.trim();
  const rows = input.split('\n');
  gridData = rows.map(row => row.trim().split(/\s+/));
  for (let i = 0; i < gridData.length; i++) {
    for (let j = 0; j < gridData[i].length; j++) {
      if (gridData[i][j] === 'S') robotPos = { x: i, y: j };
    }
  }
  drawGrid();
}

function drawGrid() {
  const table = document.getElementById("grid");
  table.innerHTML = '';
  for (let i = 0; i < 5; i++) {
    const row = table.insertRow();
    for (let j = 0; j < 5; j++) {
      const cell = row.insertCell();
      let value = gridData[i][j];
      cell.textContent = value === '.' ? '' : value;
      if (i === robotPos.x && j === robotPos.y) {
        cell.className = 'robot';
        cell.textContent = 'ğŸ¤–';
      } else if (value === 'X') {
        cell.className = 'obstacle';
      } else if (value === 'G') {
        cell.className = 'goal';
      }
    }
  }
}

function moveRobot(dx, dy) {
  if (timeExpired) return;
  const nx = robotPos.x + dx;
  const ny = robotPos.y + dy;
  if (nx < 0 || ny < 0 || nx >= 5 || ny >= 5) return;
  const nextCell = gridData[nx][ny];

  if (nextCell === 'X') {
    robotPos = { x: nx, y: ny };
    drawGrid();
    setTimeout(() => {
      document.getElementById("grid").rows[nx].cells[ny].textContent = 'ğŸ’¥';
    }, 100);
    clearInterval(countdown);
    alert("ğŸ’¥ ë¡œë´‡ì´ ì¥ì• ë¬¼ì— ë¶€ë”ªí˜”ìŠµë‹ˆë‹¤!");
    timeExpired = true;
    return;
  }

  robotPos = { x: nx, y: ny };
  if (nextCell === 'G') {
    drawGrid();
    clearInterval(countdown);
    alert("ğŸ‰ ë¯¸ì…˜ ì„±ê³µ! ì“°ë ˆê¸°ë¥¼ ì²­ì†Œí–ˆìŠµë‹ˆë‹¤!");
    timeExpired = true;
  } else {
    drawGrid();
  }
}

document.addEventListener('keydown', function (e) {
  if (timerPaused || timeExpired) return;
  switch (e.key) {
    case 'ArrowUp': moveRobot(-1, 0); break;
    case 'ArrowDown': moveRobot(1, 0); break;
    case 'ArrowLeft': moveRobot(0, -1); break;
    case 'ArrowRight': moveRobot(0, 1); break;
  }
});

function restartGame() {
  clearInterval(countdown);
  document.getElementById("timer").innerText = '';
  timerPaused = false;
  timeExpired = false;
  loadGrid();
}

function startTimer() {
  clearInterval(countdown);
  remainingTime = parseInt(document.getElementById("timeSelect").value);
  timerPaused = false;
  timeExpired = false;
  updateTimerDisplay();
  countdown = setInterval(() => {
    if (!timerPaused) {
      remainingTime--;
      updateTimerDisplay();
      if (remainingTime <= 0) {
        clearInterval(countdown);
        showTimeoutPopup();
        timeExpired = true;
      }
    }
  }, 1000);
}

function pauseTimer() {
  timerPaused = !timerPaused;
  document.querySelector("button[onclick='pauseTimer()']").innerText = timerPaused ? "â–¶ï¸ ë‹¤ì‹œ ì‹œì‘" : "â¸ï¸ ì‹œê°„ ë©ˆì¶¤";
}

function updateTimerDisplay() {
  const m = String(Math.floor(remainingTime / 60)).padStart(2, '0');
  const s = String(remainingTime % 60).padStart(2, '0');
  document.getElementById("timer").innerText = `â³ ë‚¨ì€ ì‹œê°„: ${m}:${s}`;
}

function showTimeoutPopup() {
  alert("â° ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë¡œë´‡ ì´ë™ì´ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.");
}

// ì´ˆê¸° ì‹¤í–‰
window.onload = generateRandomGrid;
</script>

</body>
</html>
